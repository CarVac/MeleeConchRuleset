name: Convert and Upload Markdown to Word
permissions:
  contents: write
on:
  push:
    # change document name here
    paths: &input "ruleset.md"
  workflow_dispatch:

jobs:
  convert_via_pandoc:
    if: github.actor != 'github-actions[bot]'
    runs-on: ubuntu-latest
    env:
      INPUT: *input
      # change document output here
      OUTPUT: ruleset.docx
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Debug environment
        run: |
          pwd
          ls
      - uses: pandoc/actions/setup@v1
      - name: Convert .md to Word
        run: |
          # Run pandoc in verbose mode and capture output
          set -o pipefail
          pandoc --standalone --verbose --output="$OUTPUT" "$INPUT" 2>&1 | tee pandoc.log
          if grep -q "image not found" pandoc.log; then
            echo "‚ùå Pandoc could not find the image."
            exit 1
          fi
      - name: Commit and Push
        run: |
          OWNER=$(echo $GITHUB_REPOSITORY | cut -d'/' -f1)
          REPO=$(echo $GITHUB_REPOSITORY | cut -d'/' -f2)
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/$OWNER/$REPO.git
          git add "$OUTPUT"
          git commit -am "update word"
          git push
